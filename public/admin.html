<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Driver Logs</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    input, button { margin: 4px; }
  </style>
</head>
<body>
  <h1>Admin - Driver Logs</h1>
  <label>Admin Token: <input id="token"></label><br>
  <label>From: <input type="date" id="from"></label>
  <label>To: <input type="date" id="to"></label>
  <button onclick="loadLogs()">Load Logs</button>
  <button onclick="markPaid()">Mark Paid</button>
  <table id="logTable">
    <thead>
      <tr>
        <th>Select</th><th>Date</th><th>Truck</th><th>Miles</th><th>Stop Value</th>
        <th>Detention</th><th>Start</th><th>End</th><th>Paid</th><th>Edit</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    async function loadLogs() {
      const token = document.getElementById('token').value;
      const from = document.getElementById('from').value;
      const to = document.getElementById('to').value;
      const res = await fetch(`/api/admin/logs?token=${token}&from=${from}&to=${to}`);
      const logs = await res.json();
      const tbody = document.querySelector('#logTable tbody');
      tbody.innerHTML = '';
      logs.forEach(log => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" value="${log.id}"></td>
          <td>${log.log_date}</td>
          <td>${log.truck}</td>
          <td>${log.miles}</td>
          <td>${log.value}</td>
          <td>${log.detention||0}</td>
          <td>${log.start_time||''}</td>
          <td>${log.end_time||''}</td>
          <td>${log.paid? 'Yes':'No'}</td>
          <td><a href="editor.html?id=${log.id}&token=${token}" target="_blank">Edit</a></td>`;
        tbody.appendChild(tr);
      });
    }
    async function markPaid() {
      const token = document.getElementById('token').value;
      const ids = Array.from(document.querySelectorAll('tbody input:checked')).map(cb=>cb.value);
      await fetch(`/api/admin/mark-paid?token=${token}`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ ids })
      });
      loadLogs();
    }
  </script>
</body>
</html>
