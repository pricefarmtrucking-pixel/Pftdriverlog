<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Driver Logs — Admin</title>
  <style>
    body{font:15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin:0; background:#0b1016; color:#e7eef7}
    header{padding:14px 18px; background:#131b24; border-bottom:1px solid #1e2a36; position:sticky; top:0}
    h1{margin:0; font-size:18px}
    .wrap{max-width:1100px; margin:0 auto; padding:18px}
    .card{background:#131b24; border:1px solid #1e2a36; border-radius:12px; padding:14px; margin-bottom:16px}
    table{width:100%; border-collapse:collapse}
    th,td{border-top:1px solid #233142; padding:8px; text-align:left}
    th{font-size:12px; text-transform:uppercase; color:#a9b8c8; letter-spacing:.05em}
    input,select,button{padding:8px; border-radius:8px; border:1px solid #2a394a; background:#0f1620; color:#e7eef7}
    .btn{background:#4cc38a; color:#0b1016; font-weight:700; border:0; padding:8px 12px; border-radius:10px; cursor:pointer}
  </style>
</head>
<body>
<header><h1>Driver Logs — Admin</h1></header>
<div class="wrap">
  <div class="card">
    <label>Admin Token</label>
    <input id="adminTok" placeholder="Enter admin token">
    <button class="btn" id="btnCheck">Check</button>
    <pre id="out" style="white-space:pre-wrap"></pre>
  </div>

  <div class="card">
    <h3>Pending Approvals</h3>
    <button class="btn" id="btnLoadPending">Load Pending</button>
    <table id="tbl"><thead><tr>
      <th>ID</th><th>Date</th><th>Driver</th><th>Truck</th><th>Miles</th><th>Value</th><th>Det (min)</th><th>Approve</th>
    </tr></thead><tbody></tbody></table>
  </div>
</div>

<script>
const api = location.origin;

function h(e){return document.getElementById(e)}
function rowHTML(r){
  return `<tr>
    <td>${r.id}</td><td>${r.log_date}</td><td>${r.driver_name}</td><td>${r.truck_unit}</td>
    <td>${r.miles}</td><td>${r.value}</td><td>${r.detention_minutes}</td>
    <td><button data-id="${r.id}" class="ap">Approve</button></td>
  </tr>`;
}

h('btnCheck').onclick = async ()=>{
  const tok=h('adminTok').value.trim();
  const r=await fetch(`${api}/api/admin/tokens`, { headers:{'X-Auth':tok}});
  h('out').textContent = await r.text();
};

h('btnLoadPending').onclick = async ()=>{
  const tok=h('adminTok').value.trim();
  const r=await fetch(`${api}/api/approvals/pending`, { headers:{'X-Auth':tok}});
  const rows=await r.json();
  const tb=h('tbl').querySelector('tbody'); tb.innerHTML='';
  rows.forEach(x=> tb.insertAdjacentHTML('beforeend', rowHTML(x)) );
};

document.addEventListener('click', async (e)=>{
  const b = e.target.closest('.ap'); if(!b) return;
  const id=b.dataset.id; const tok=h('adminTok').value.trim();
  const r=await fetch(`${api}/api/approvals/${id}/approve`, { method:'POST', headers:{'X-Auth':tok}});
  if (r.ok) { b.closest('tr').remove(); } else { alert('Approve failed'); }
});
</script>
</body>
</html>
